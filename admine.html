<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qoutok - Admin Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #111827; --card: #1f2937; --primary: #25f4ee; --danger: #ef4444; --text: #f3f4f6; --sidebar: #0f1115; }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Tajawal', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        
        /* Layout */
        .sidebar { width: 260px; background: var(--sidebar); border-left: 1px solid #333; display: flex; flex-direction: column; padding: 20px; }
        .logo { font-size: 1.8rem; color: var(--primary); font-weight: bold; margin-bottom: 40px; text-align: center; letter-spacing: 1px; }
        .menu-item { padding: 15px; cursor: pointer; border-radius: 10px; color: #aaa; transition: 0.3s; display: flex; align-items: center; gap: 12px; margin-bottom: 5px; font-weight: 500; }
        .menu-item:hover, .menu-item.active { background: rgba(37, 244, 238, 0.1); color: var(--primary); }
        
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .section { display: none; animation: fade 0.3s; }
        .section.active { display: block; }
        
        /* Components */
        .card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #333; margin-bottom: 20px; }
        .stat-num { font-size: 2.5rem; font-weight: bold; margin-top: 10px; }
        
        input, textarea { width: 100%; padding: 15px; background: #000; border: 1px solid #444; color: white; border-radius: 10px; margin-bottom: 15px; font-family: inherit; }
        button { width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 10px; color: #000; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { filter: brightness(0.9); }
        
        /* Tables & Lists */
        .msg-item { background: #2d3748; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-right: 4px solid var(--primary); }
        .msg-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: #aaa; }
        .btn-reply { background: #48bb78; color: white; width: auto; padding: 5px 15px; font-size: 0.8rem; }

        /* Login */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        
        @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="card" style="width: 400px; text-align: center;">
            <h2 style="color:var(--primary); margin-bottom:20px;">Qoutok Admin</h2>
            <input type="password" id="pass-key" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="Auth.check()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div class="sidebar">
        <div class="logo">Qoutok <span style="color:#fff; font-size:0.5em;">CONTROL</span></div>
        <div class="menu-item active" onclick="Nav.to('dash')"><i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
        <div class="menu-item" onclick="Nav.to('security')"><i class="fas fa-shield-alt"></i> Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„Ø­Ø¸Ø±</div>
        <div class="menu-item" onclick="Nav.to('messages')"><i class="fas fa-inbox"></i> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ø±Ø¯ÙˆØ¯</div>
        <div class="menu-item" onclick="Nav.to('posts')"><i class="fas fa-stream"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>
        <div class="menu-item" onclick="Nav.to('notify')"><i class="fas fa-bullhorn"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</div>
    </div>

    <div class="main-content">
        
        <div id="sec-dash" class="section active">
            <h2>ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h3><div class="stat-num" id="stat-posts">0</div></div>
                <div class="card"><h3>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3><div class="stat-num" id="stat-msgs" style="color:#fcd34d;">0</div></div>
                <div class="card"><h3>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©</h3><div class="stat-num" id="stat-banned" style="color:#ef4444;">0</div></div>
            </div>
        </div>

        <div id="sec-security" class="section">
            <div class="card">
                <h2>ğŸš« ÙÙ„ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©</h2>
                <p style="color:#aaa; margin-bottom:15px;">Ø£ÙŠ Ù…Ù†Ø´ÙˆØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø³ÙŠØªÙ… Ù…Ù†Ø¹Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
                <textarea id="banned-words" rows="5" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø© (Ù…Ø«Ø§Ù„: ÙƒÙ„Ù…Ø©1, ÙƒÙ„Ù…Ø©2, Ø´ØªÙŠÙ…Ø©...)"></textarea>
                <button onclick="Admin.saveBannedWords()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
        </div>

        <div id="sec-messages" class="section">
            <h2>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
            <div id="messages-list" style="margin-top:20px;"></div>
        </div>

        <div id="sec-posts" class="section">
            <h2>Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
            <div id="posts-list" style="margin-top:20px;"></div>
        </div>

        <div id="sec-notify" class="section">
            <div class="card" style="max-width:500px;">
                <h2>Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù…</h2>
                <input type="text" id="notif-title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
                <textarea id="notif-body" placeholder="Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></textarea>
                <button onclick="Admin.sendNotify()">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
            </div>
        </div>

    </div>

<script>
// ğŸ”¥ Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ØªÙ…Ø§Ù…Ø§Ù‹ ğŸ”¥
const firebaseConfig = {
    apiKey: "AIzaSyAfz9k1oG3rwiv4Lsfy7Dl92PxuzsrYqB8",
    authDomain: "qoutok.firebaseapp.com",
    projectId: "qoutok",
    storageBucket: "qoutok.firebasestorage.app",
    messagingSenderId: "580116525824",
    appId: "1:580116525824:web:d855472417f0682f2c39e5",
    measurementId: "G-RETNEQJCKB"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const Auth = {
    check() {
        if(document.getElementById('pass-key').value === "a7-.8k") {
            document.getElementById('login-screen').style.display = 'none';
            Admin.init();
        } else alert("Ø®Ø·Ø£!");
    }
};

const Nav = {
    to(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        document.getElementById('sec-'+id).classList.add('active');
        event.currentTarget.classList.add('active');
    }
};

const Admin = {
    init() {
        this.loadStats();
        this.loadMessages();
        this.loadPosts();
        this.loadBannedWords();
    },

    loadStats() {
        db.ref('posts').on('value', s => document.getElementById('stat-posts').innerText = s.numChildren());
        db.ref('messages').on('value', s => document.getElementById('stat-msgs').innerText = s.numChildren());
    },

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¸Ø± ---
    loadBannedWords() {
        db.ref('settings/bannedWords').on('value', snap => {
            const words = snap.val() || "";
            document.getElementById('banned-words').value = words;
            document.getElementById('stat-banned').innerText = words ? words.split(',').length : 0;
        });
    },

    saveBannedWords() {
        const words = document.getElementById('banned-words').value;
        db.ref('settings/bannedWords').set(words).then(() => alert("ØªÙ… Ø­ÙØ¸ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø­Ø¸Ø±!"));
    },

    // --- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ø±Ø¯ÙˆØ¯ ---
    loadMessages() {
        db.ref('messages').limitToLast(20).on('value', snap => {
            const div = document.getElementById('messages-list');
            div.innerHTML = '';
            snap.forEach(child => {
                const m = child.val();
                div.innerHTML = `
                    <div class="msg-item">
                        <div class="msg-header">
                            <span>Ù…Ù†: ${m.email}</span>
                            <span>${new Date(m.date).toLocaleDateString()}</span>
                        </div>
                        <p style="font-size:1.1rem; margin:10px 0;">${m.message}</p>
                        <button class="btn-reply" onclick="Admin.reply('${child.key}', '${m.email}')">Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                    </div>
                ` + div.innerHTML;
            });
        });
    },

    reply(msgId, email) {
        const response = prompt("Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù„Ù€ " + email + ":");
        if(response) {
            // Ø­ÙØ¸ Ø§Ù„Ø±Ø¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Øª Ø¹Ù‚Ø¯Ø© 'replies'
            // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙƒÙ…Ø¹Ø±Ù (Ø¨Ø¹Ø¯ ØªÙ†Ø¸ÙŠÙÙ‡ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø·) Ø£Ùˆ Ù†Ø±Ø³Ù„ Ù„Ù„ÙƒÙ„
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£Ø³Ù‡Ù„: Ø­ÙØ¸ Ø§Ù„Ø±Ø¯ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
            const cleanEmail = email.replace(/\./g, '_'); // Firebase keys can't have dots
            db.ref('replies/' + cleanEmail).push({
                reply: response,
                date: Date.now(),
                admin: "Ø§Ù„Ù…Ø·ÙˆØ±"
            });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯! Ø³ÙŠØ±Ø§Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¯ÙˆØ¯.");
        }
    },

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ---
    loadPosts() {
        db.ref('posts').limitToLast(20).on('value', snap => {
            const div = document.getElementById('posts-list');
            div.innerHTML = '';
            snap.forEach(child => {
                const p = child.val();
                div.innerHTML = `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                        <div>${p.text.substring(0, 40)}... <span style="color:#777">(${p.author})</span></div>
                        <button style="background:#ef4444; width:auto; padding:5px 10px;" onclick="Admin.deletePost('${child.key}')">Ø­Ø°Ù</button>
                    </div>
                ` + div.innerHTML;
            });
        });
    },

    deletePost(id) {
        if(confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ')) db.ref('posts/'+id).remove();
    },

    sendNotify() {
        const t = document.getElementById('notif-title').value;
        const b = document.getElementById('notif-body').value;
        if(t) db.ref('announcements').push({ title: t, body: b, date: Date.now() }).then(()=>alert("ØªÙ…!"));
    }
};
</script>
</body>
</html>
